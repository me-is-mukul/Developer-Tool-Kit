#!/bin/bash

NC="\033[0m"
RED="\033[38;5;203m"
GREEN="\033[38;5;114m"
YELLOW="\033[38;5;180m"
BLUE="\033[38;5;75m"
MAGENTA="\033[38;5;139m"
CYAN="\033[38;5;73m"
WHITE="\033[38;5;255m"

clear
echo -e "${BLUE}============================================================${NC}"
echo -e "${CYAN}         MACHINE LEARNING DEVELOPMENT KIT${NC}"
echo -e "${BLUE}============================================================${NC}"
echo -e "${MAGENTA}         ðŸ’»  Environment Setup (Auto Venv)  ðŸ’»${NC}\n"

echo -e "${BLUE}------------------------------------------------------------"
echo -e "                Checking Python, pip, and venv"
echo -e "------------------------------------------------------------${NC}"

if ! command -v python3 >/dev/null 2>&1; then
    echo -e "${RED}âœ– Python not found. Installing...${NC}"
    sudo apt update && sudo apt install -y python3 python3-pip python3-venv || {
        echo -e "${RED}âŒ Python installation failed.${NC}"
        exit 1
    }
else
    echo -e "${GREEN}âœ” Python installed:${NC} $(python3 --version)"
fi

if ! command -v pip3 >/dev/null 2>&1; then
    echo -e "${YELLOW}âš  pip missing. Installing...${NC}"
    sudo apt install -y python3-pip || {
        echo -e "${RED}âŒ pip installation failed.${NC}"
        exit 1
    }
else
    echo -e "${GREEN}âœ” pip installed${NC}"
fi

PY_VER=$(python3 -c "import sys; print(f'{sys.version_info.major}.{sys.version_info.minor}')")
sudo apt install -y python${PY_VER}-venv >/dev/null 2>&1
echo -e "${GREEN}âœ” python${PY_VER}-venv ready${NC}"

echo -e "\n${BLUE}------------------------------------------------------------"
echo -e "       Creating Virtual Environment in Current Directory"
echo -e "------------------------------------------------------------${NC}"

VENV_PATH="./venv"

if [ -d "$VENV_PATH" ] && [ -f "$VENV_PATH/bin/activate" ]; then
    echo -e "${GREEN}âœ” Existing valid venv detected.${NC}"
else
    echo -e "${CYAN}â†’ Creating new venv...${NC}"
    rm -rf "$VENV_PATH"
    python3 -m venv "$VENV_PATH" || {
        echo -e "${RED}âŒ Failed creating virtual environment.${NC}"
        exit 1
    }
    echo -e "${GREEN}âœ” Virtual environment created.${NC}"
fi

echo -e "${BLUE}â†’ Activating venv...${NC}"
source "$VENV_PATH/bin/activate" || {
    echo -e "${RED}âŒ Failed activating venv.${NC}"
    exit 1
}

echo -e "${CYAN}â†’ Upgrading pip inside venv...${NC}"
pip install --upgrade pip

echo -e "\n${BLUE}------------------------------------------------------------"
echo -e "                Machine Learning Libraries"
echo -e "------------------------------------------------------------${NC}"

read -p "$(echo -e "${WHITE}Install core ML libraries? (numpy, pandas, sklearn) [Y/n]: ${NC}")" ML
if [[ "$ML" =~ ^[Yy]$ || -z "$ML" ]]; then
    echo -e "${CYAN}â†’ Installing ML libraries...${NC}"
    pip install numpy pandas matplotlib seaborn scikit-learn scipy || {
        echo -e "${RED}âŒ ML library installation failed.${NC}"
        exit 1
    }
    echo -e "${GREEN}âœ” ML libraries installed.${NC}"
fi

read -p "$(echo -e "${WHITE}Install Jupyter Notebook & Lab? [Y/n]: ${NC}")" JP
if [[ "$JP" =~ ^[Yy]$ || -z "$JP" ]]; then
    echo -e "${CYAN}â†’ Installing Jupyter...${NC}"
    pip install notebook jupyterlab || {
        echo -e "${RED}âŒ Jupyter installation failed.${NC}"
        exit 1
    }
    echo -e "${GREEN}âœ” Jupyter installed.${NC}"
fi

read -p "$(echo -e "${WHITE}Install Git? [Y/n]: ${NC}")" GT
if [[ "$GT" =~ ^[Yy]$ || -z "$GT" ]]; then
    sudo apt install -y git
    echo -e "${GREEN}âœ” Git installed.${NC}"
fi

read -p "$(echo -e "${WHITE}Install Visual Studio Code? [Y/n]: ${NC}")" VC
if [[ "$VC" =~ ^[Yy]$ || -z "$VC" ]]; then
    echo -e "${CYAN}â†’ Installing VS Code...${NC}"
    sudo apt install -y wget gpg apt-transport-https
    wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor |
        sudo tee /usr/share/keyrings/ms_vscode_key.gpg >/dev/null

    echo "deb [arch=amd64 signed-by=/usr/share/keyrings/ms_vscode_key.gpg] https://packages.microsoft.com/repos/vscode stable main" |
        sudo tee /etc/apt/sources.list.d/vscode.list >/dev/null

    sudo apt update && sudo apt install -y code
    echo -e "${GREEN}âœ” VS Code installed.${NC}"
fi

echo -e "\n${GREEN}============================================================"
echo -e "           Setup Completed Successfully!"
echo -e "============================================================${NC}\n"

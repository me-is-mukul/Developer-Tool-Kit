#!/bin/bash

# --- Colors (minimal) ---
NC="\033[0m"
GREEN="\033[0;32m"
YELLOW="\033[1;33m"
RED="\033[0;31m"
BLUE="\033[0;34m"

echo -e "${BLUE}=== Machine Learning Environment Setup ===${NC}"

# ------------------- Python & pip --------------------
echo -e "\n${BLUE}[1] Checking Python & pip...${NC}"

if ! command -v python3 >/dev/null; then
    echo -e "${YELLOW}Python not found. Installing...${NC}"
    sudo apt update && sudo apt install -y python3 python3-pip python3-venv || {
        echo -e "${RED}Python installation failed.${NC}"
        exit 1
    }
else
    echo -e "${GREEN}Python is installed: $(python3 --version)${NC}"
fi

if ! command -v pip3 >/dev/null; then
    echo -e "${YELLOW}pip missing. Installing...${NC}"
    sudo apt install -y python3-pip
else
    echo -e "${GREEN}pip found${NC}"
fi

# --------------------- venv --------------------------
echo -e "\n${BLUE}[2] Creating Virtual Environment (./venv)...${NC}"

VENV_PATH="./venv"
PY_VER=$(python3 -c "import sys; print(f'{sys.version_info.major}.{sys.version_info.minor}')")
sudo apt install -y python${PY_VER}-venv >/dev/null 2>&1

if [ ! -d "$VENV_PATH" ] || [ ! -f "$VENV_PATH/bin/activate" ]; then
    rm -rf "$VENV_PATH"
    python3 -m venv "$VENV_PATH" || {
        echo -e "${RED}Failed to create venv.${NC}"
        exit 1
    }
    echo -e "${GREEN}Virtual environment created.${NC}"
else
    echo -e "${GREEN}Valid venv already exists.${NC}"
fi

source "$VENV_PATH/bin/activate"
pip install --upgrade pip >/dev/null

# ---------------- ML Libraries -----------------------
echo -e "\n${BLUE}[3] ML Libraries${NC}"
read -p "Install numpy, pandas, sklearn? [Y/n]: " ML

if [[ "$ML" =~ ^[Yy]$ || -z "$ML" ]]; then
    echo -e "${YELLOW}Installing ML libraries...${NC}"
    pip install numpy pandas matplotlib seaborn scikit-learn scipy
fi

# ---------------- Jupyter ----------------------------
read -p "Install Jupyter Notebook & Lab? [Y/n]: " JP
if [[ "$JP" =~ ^[Yy]$ || -z "$JP" ]]; then
    echo -e "${YELLOW}Installing Jupyter...${NC}"
    pip install notebook jupyterlab
fi

# ---------------- Git ----------------------------
read -p "Install Git? [Y/n]: " GT
if [[ "$GT" =~ ^[Yy]$ || -z "$GT" ]]; then
    sudo apt install -y git
fi

# ---------------- VS Code ----------------------------
read -p "Install VS Code? [Y/n]: " VC
if [[ "$VC" =~ ^[Yy]$ || -z "$VC" ]]; then
    echo -e "${YELLOW}Installing VS Code...${NC}"
    sudo apt install -y wget gpg apt-transport-https
    wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor |
        sudo tee /usr/share/keyrings/ms_vscode_key.gpg >/dev/null

    echo "deb [arch=amd64 signed-by=/usr/share/keyrings/ms_vscode_key.gpg] https://packages.microsoft.com/repos/vscode stable main" |
        sudo tee /etc/apt/sources.list.d/vscode.list >/dev/null

    sudo apt update && sudo apt install -y code
fi

# ----------------- Done -----------------------------
echo -e "\n${GREEN}Setup complete.${NC}"
